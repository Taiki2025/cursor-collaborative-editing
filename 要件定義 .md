# 要件定義

```markdown
# 総合要件定義＆UI設計ドキュメント

以下は、AIエージェントUI（360度ビュー）の業務要件・システム要件・UIデザイン・デモモード・追加改善ポイントを全て網羅した詳細ドキュメントです。ダミーデータも完全に記載しています。

---

## 1. プロジェクト概要

- **目的**：コールセンターオペレーターが以下５業務を360度ビュー単一画面で完結操作し、応答速度・正確性を向上させる。
  1. 再点申込
  2. 使用量計算～料金計算
  3. 請求・未収管理
  4. 契約変更
  5. 契約廃止

- **フェーズ**
  1. UIモックアップ詳細設計
  2. プロトタイプ検証
  3. バックエンド連携／AIエージェント実装

---

## 2. 業務要件定義

### 2.1 目的・範囲

- **目的**：オペレーター操作ステップを最小化し、画面遷移・他システム呼び出し不要で業務完結
- **画面**：360度ビュー「契約・サービス」タブ内
- **非対象**：バッチ処理、詳細レポート、他プラットフォーム深部連携

### 2.2 利用シナリオ（ユースケース一覧）

| UC-ID  | ユースケース名         | アクター       | 前提条件                   | 主なフロー                                     |
|-------|-----------------------|--------------|--------------------------|---------------------------------------------|
| UC-01 | 再点申込              | オペレーター | 顧客・契約情報登録済み       | 検索→未収確認→再点候補提示→予約実行              |
| UC-02 | 使用量／料金シミュレーション | オペレーター | 過去12ヶ月検針データ取得可    | プラン選択→使用量予測入力→試算→確定／キャンセル   |
| UC-03 | 請求・未収管理         | オペレーター | 当月請求データ取得済み       | 未収ハイライト→督促履歴参照→振込案内生成           |
| UC-04 | 契約プラン変更         | オペレーター | 顧客同意取得済み             | プラン提案→同意確認→API呼び出し→完了通知          |
| UC-05 | 契約廃止              | オペレーター | 廃止要因ヒアリング完了       | 理由選択→廃止日決定→最終試算→廃止確定             |

### 2.3 業務フロー詳細（UC-01：再点申込）

1. **顧客検索**
   - **入力**：
     - 顧客ID：`CUST-2025-0001`
     - 契約ID：`CTR-09-1234-5678`
   - **成果**：画面上部に顧客／契約カード表示

2. **未収・入金履歴確認**
   | 項目         | 値             |
   |------------|---------------|
   | 未収金額     | ¥15,430       |
   | 未収期間     | 3ヶ月         |
   | 最終入金日   | 2025/05/20    |

3. **再点可能日算出**
   ```json
   {
     "earliest_date": "2025-08-12",
     "available_slots": ["09:00","13:00","15:30"]
   }

```

- カレンダー＋時間ドロップダウンで選択
1. **再点予約実行**
    - ［再点予約］ボタン押下 →
    - ダイアログ表示：
        
        > 再点予約完了：2025年08月12日 13:00（ID: RES-20250812-0001）
        > 

---

## 3. タブ別ダミーデータ

### 3.1 概要タブ（Overview）

| フィールド | 値 |
| --- | --- |
| 顧客ID | `CUST-2025-0001` |
| 顧客名 | 山田 太郎 |
| 契約ID | `CTR-09-1234-5678` |
| プラン | ナイト・セレクト |
| アンペア | 40A |
| 契約ステータス | Active |
| 最終更新日時 | 2025/08/01 14:32 |

---

### 3.2 請求履歴タブ（Billing History）

| 年月 | 請求額（¥） | 支払状況 |
| --- | --- | --- |
| 2025/07 | 7,980 | Paid |
| 2025/06 | 8,120 | Paid |
| 2025/05 | 8,350 | Unpaid |
| 2025/04 | 7,650 | Paid |
| 2025/03 | 7,420 | Paid |

---

### 3.3 未収管理タブ（Unpaid Management）

| 請求ID | 月 | 請求額（¥） | 未収期間 | 最終督促日 | 次回督促予定 |
| --- | --- | --- | --- | --- | --- |
| BILL-202505 | 2025/05 | 8,350 | 3ヶ月 | 2025/06/10 | 2025/08/10 |
| BILL-202504 | 2025/04 | 7,650 | 4ヶ月 | 2025/05/12 | 2025/08/12 |

---

### 3.4 契約・サービスタブ（Contract & Service）

| 項目 | フィールド名 | 値 |
| --- | --- | --- |
| 供給地点特定番号 | supply_point_id | `09-1234-1234-1234-0000-0000` |
| 契約開始日 | contract_start_date | 2020/10/01 |
| 更新日 | contract_renewal_date | 2024/10/01 |
| プラン変更履歴 | plan_change_history | 2023/11/15: レギュラー → ナイト・セレクト |
| 過去12ヶ月平均使用量 (kWh) | avg_usage_12mo | 235 |
| 現在請求アンペア | ampere | 40A |

---

### 3.5 再点申込タブ（Restore Power）

- **検索フォーム**
    - 顧客ID：`CUST-2025-0001`
    - 契約ID：`CTR-09-1234-5678`
- **未収情報**：未収金額 ¥15,430、未収期間 3ヶ月
- **再点可能日**：2025-08-12（09:00, 13:00, 15:30）
- **予約結果**：
    
    > ID: RES-20250812-0001
    > 
    > 
    > 予約日時: `2025-08-12 13:00`
    > 

---

### 3.6 料金シミュレーションタブ（Simulation）

| 入力パラメータ | 値 |
| --- | --- |
| 現行プラン | ナイト・セレクト |
| 予測使用量 (kWh/月) | 250 |
| 選択プラン候補 | レギュラー, デイタイム |

**試算結果**

| プラン名 | 月次料金試算（¥） | 差分（現行比） |
| --- | --- | --- |
| レギュラー | 9,200 | +1,220 |
| デイタイム | 10,500 | +2,520 |

---

### 3.7 契約変更タブ（Change Plan）

- **AI提案プラン**：レギュラー（試算 ¥9,200/月）
- **顧客同意**：☑ チェック済み
- **API結果**：
    
    > 変更ID: CHG-20250806-0001
    > 
    > 
    > 変更日時: `2025-08-06 10:15`
    > 

---

### 3.8 契約廃止タブ（Termination）

| 項目 | 値 |
| --- | --- |
| 廃止理由 | 引越しによる解約 |
| 希望廃止日 | 2025/07/31 |
| 確定廃止日 | 2025/07/31 |
| 廃止前最終使用量 | 220 kWh |
| 最終請求額 | ¥7,753 |
| 帳票リンク | [廃止通知書PDFをダウンロード](https://chatgpt.com/g/g-p-689308ddd50481918d04804cf65c2c7d-sisutemu/c/68935f80-0108-8320-bb9e-92d8c3789640?model=o4-mini-high) |

---

### 3.9 対応履歴タブ（Interaction History）

| 日時 | 担当者 | 要約 |
| --- | --- | --- |
| 2025-08-01 14:30 | Ops_A | 電話着信→未収確認→再点申込提案 |
| 2025-07-25 09:15 | Ops_B | プラン変更シミュレーション→レギュラー提案 |
| 2025-07-10 16:45 | Ops_C | 廃止理由ヒアリング（引越し）→廃止手続き案内 |

---

## 4. デモモード：動的会話＆要約＆チャットボット

### 4.1 通話ログ（左カラム）動的サンプル

```json
[
  { "timestamp":"14:00:01","speaker":"顧客","text":"もしもし、電気が止まってしまったんですが…" },
  { "timestamp":"14:00:05","speaker":"オペレーター","text":"申し訳ありません。契約番号をお願いします。" },
  { "timestamp":"14:00:12","speaker":"顧客","text":"CTR-09-1234-5678です。" },
  { "timestamp":"14:00:15","speaker":"オペレーター","text":"未収¥15,430、最終入金2025/05/20です。" },
  { "timestamp":"14:00:30","speaker":"オペレーター","text":"再点候補は08/12 09:00,13:00,15:30です。いかがですか？" },
  { "timestamp":"14:00:45","speaker":"顧客","text":"13:00でお願いします。" }
]

```

- **動的演出**：1秒毎に次の発言フェードイン
- **折りたたみ要約**：直近5発言を要約表示

### 4.2 要約ウィンドウ（30秒毎更新）

| 更新時刻 | 要約テキスト |
| --- | --- |
| 14:00:30 | 「再点申込：CTR-09-1234-5678、未収¥15,430、08/12 13:00で予約予定」 |
| 14:01:00 | 「予約実行中… → 完了：ID RES-20250812-0001（08/12 13:00）」 |
- **差分強調**：完了時に「完了」をハイライト

### 4.3 チャットボットパネル Q&A例

| 質問 | ボット応答 |
| --- | --- |
| 再点申込の手順を教えて | 1. 契約番号入力 → 2. 未収確認 → 3. 再点日選択 → 4. 予約実行 |
| 今回の請求額はいくら？ | 2025年7月分は¥7,980（支払期限：08/20） |
| プラン変更後の試算を比較して | レギュラー: ¥9,200/月(+¥1,220)、デイタイム: ¥10,500/月(+¥2,520) |
| ハラスメント検知機能とは？ | 通話中にパワハラワード検出→即アラート＆管理者通知 |
| 廃止手続きPDFを取れる？ | [ダウンロード](https://chatgpt.com/reports/termination/CTR-09-1234-5678.pdf) |

### 4.4 チャット履歴JSON

```json
[
  { "time":"14:02","sender":"user","text":"請求額教えて？" },
  { "time":"14:02","sender":"bot","text":"¥7,980（期限：2025/08/20）" },
  { "time":"14:03","sender":"user","text":"プラン変更後の比較" },
  { "time":"14:03","sender":"bot","text":"レギュラー: ¥9,200/月, デイタイム: ¥10,500/月" }
]

```

---

## 5. チャットボットパネル（右カラム）設計要件

### 5.1 レイアウト

```
┌──────────────────────────┐
│ My Assistant（ヘッダー）  │
├──────────────────────────┤
│ ● メッセージエリア        │
│   - ユーザー（左）        │
│   - AI（右）              │
│   - タイムスタンプ        │
├──────────────────────────┤
│ ◉ 入力エリア              │
│   - テキスト入力          │
│   - 送信ボタン（紙飛行機）│
│   - 音声入力アイコン       │
└──────────────────────────┘

```

- 幅：360度ビューの25％
- 高さ：100％（縦スクロール）

### 5.2 コンポーネント仕様

| 要素 | 仕様 |
| --- | --- |
| ヘッダー | 背景`#005BAC`、文字`#FFFFFF` 16px Bold |
| メッセージバブル | ユーザー：背景`#F0F0F0`／文字`#333333`AI：背景`#005BAC`／文字`#FFFFFF`角丸12px |
| タイムスタンプ | 12px `#666666`、バブル下部に表示 |
| 入力欄 | 40px高／角丸8px／プレースホルダ例「再点申込の手順」 |
| 送信ボタン | リフトアップ（translateY(-2px)）エフェクト |
| 音声入力 | マイクアイコン／長押しで文字起こし |

### 5.3 機能要件

1. `POST /api/chat` → AI応答取得・表示
2. FAQモーダル（?アイコン）
3. 入力補完／サジェスト
4. 音声入力→文字起こし
5. セッション毎100メッセージ保持
6. エラー時「再試行」リンク表示

### 5.4 UI/UX要件

- レスポンシブ（最低幅320px）
- キーボード：Enter送信／↑で編集
- アクセシビリティ：WCAG2.1 AA、コントラスト4.5:1以上
- アニメーション：新着メッセージフェードイン

### 5.5 非機能要件

- 応答時間：2秒以内
- 同時接続：300セッション
- TLS1.2／CSRF対策
- チャットログ6ヶ月保持

---

## 6. システム要件定義

### 6.1 機能要件一覧

| ID | 機能 | APIエンドポイント／概要 |
| --- | --- | --- |
| F-01 | 顧客検索 | `GET /api/customers/{customer_id}` → 顧客契約情報取得 |
| F-02 | 検針データ取得 | `GET /api/meter-readings?contract={id}&period=12m` |
| F-03 | 料金シミュレーション | `POST /api/simulate` → プラン・使用量送信／試算結果取得 |
| F-04 | 再点予約登録 | `POST /api/restore-power` → 希望日時登録 |
| F-05 | 帳票PDF生成 | `GET /api/reports/termination/{contract_id}` → PDF取得 |
| F-06 | チャット | `POST /api/chat` → Q&A |
| F-07 | ハラスメント検知 | `POST /api/harassment-check` → 検知結果取得 |

### 6.2 非機能要件

| 項目 | 要件 |
| --- | --- |
| 応答性能 | 画面遷移300ms以内／AI要約2秒以内 |
| 可用性 | 99.9%（月DT≦43分） |
| 同時接続数 | 500セッション（業務ピーク想定） |
| セキュリティ | TLS1.2+／RBAC／OWASP Top10対策 |
| ログ保持 | 監査ログ1年／操作ログ6ヶ月 |
| 障害対応 | 検知後1時間以内エスカレーション |

### 6.3 データ要件

### 顧客マスタ

| フィールド | 型 | サンプル |
| --- | --- | --- |
| customer_id | string | `CUST-2025-0001` |
| name | string | `山田 太郎` |
| address | string | `東京都千代田区丸の内1-1-1` |

### 検針マスタ

| フィールド | 型 | サンプル |
| --- | --- | --- |
| reading_id | string | `READ-202507` |
| date | date | 2025-07-31 |
| kwh | int | 215 |

### 請求マスタ

| フィールド | 型 | サンプル |
| --- | --- | --- |
| billing_id | string | `BILL-202508` |
| amount | int | 7980 |
| due_date | date | 2025-08-20 |

### 6.4 インターフェース仕様（例）

### 再点予約API

```
POST /api/restore-power
Request:
{
  "contract_id":"CTR-09-1234-5678",
  "datetime":"2025-08-12T13:00:00+09:00"
}
Response 201:
{ "reservation_id":"RES-20250812-0001" }

```

### チャットAPI

```
POST /api/chat
Request:
{ "session_id":"S-0001", "message":"再点申込の手順は？" }
Response:
{ "reply":"契約番号入力→未収確認→…の流れです。" }

```

---

## 7. 追加検討・改善ポイント

1. **感情・トーン分析**
    - リアルタイム感情スコア可視化／スクリプト提案
2. **ナレッジベース連携**
    - 通話内容からFAQ自動サジェスト・登録支援
3. **多言語対応**
    - 自動翻訳（日本語↔英語等）、多言語UI
4. **エスカレーションワークフロー**
    - クレーム／ハラ検知で即トリガ発動、ステータス管理
5. **コールサマリー出力**
    - PDF生成＋CRM（Salesforce等）自動アップロード
6. **KPIダッシュボード**
    - 初回解決率、平均通話時間、検知率などを可視化
7. **フォローアップリマインダー**
    - 再点後／契約変更後の自動リマインド登録
8. **モバイル対応**
    - タブレットUI最適化、タッチ操作強化
9. **ダークモード**
    - ユーザー好みでライト／ダークテーマ切替
10. **オンボーディングチュートリアル**
    - 初回利用時にガイドツアー表示
11. **パフォーマンス最適化**
    - キャッシュ戦略、CDN配信
12. **アナリティクス・監視**
    - イベントトラッキング、アラート設定（Prometheus/Grafana）
13. **DR／バックアップ**
    - 定期スナップショット、フェイルオーバー手順

---

## 8. 運用・監視・テスト・セキュリティ計画

- **運用・監視**：メトリクス収集、アラート設定、SLAレポート
- **テスト計画**：E2Eシナリオ、負荷テスト（500同時）、セキュリティテスト
- **トレーニング**：オペレータ手順マニュアル、FAQドキュメント
- **DR／バックアップ**：デイリー／ウィークリー定期バックアップ
- **ログ管理**：機密情報マスキング、長期アーカイブ
- **承認フロー**：設計レビュー→セキュリティレビュー→本番リリース
- **アクセシビリティ検証**：色覚シミュレータ、キーボード操作網羅

---

## 9. 今後のステップ

1. **Figmaでハイファイモック作成**
2. **プロトタイプユーザーテスト**
3. **A/Bテスト設計**
4. **バックエンド連携開発**
5. **セキュリティ／パフォーマンステスト**
6. **ローンチ＆運用開始**

---

## 10. ダミーデータ一覧まとめ

| Key | Value |
| --- | --- |
| 顧客ID | CUST-2025-0001 |
| 契約ID | CTR-09-1234-5678 |
| 再点予約ID | RES-20250812-0001 |
| プラン変更ID | CHG-20250806-0001 |
| 直近使用量 (kWh) | 215 |
| 当月請求額 (¥) | 7,980 |
| 未収金額 (¥) | 15,430 |
| 廃止理由 | 引越しによる解約 |
| 廃止日 | 2025-07-31 |