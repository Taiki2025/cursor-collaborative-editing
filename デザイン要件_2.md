# デザイン要件_2

```markdown
# 追加要件：レイアウト調整＆キーワードトリガ型パーソナライズ

---

## 1. レイアウト調整：チャットボットパネル完全表示

- **右カラム幅の調整**
  - 現状：360度ビューの25% → 見切れ発生
  - 修正後：30%（必要に応じ可変幅）
  - 中央メイン幅：45%、左カラム：25% を推奨
- **最小幅保証**
  - 右カラムは幅320px以上を常に確保
  - ウィンドウ幅縮小時は左／中央を優先し、右カラムはスクロールバー表示
- **CSS例**
  ```css
  .container { display: flex; }
  .left   { flex: 0 0 25%;   min-width: 300px; }
  .center { flex: 1 1 45%;   min-width: 500px; }
  .right  { flex: 0 0 30%;   min-width: 320px; overflow-y: auto; }

```

- **レスポンシブ対応**
    - 幅 ≤1200px：中央33%／右33%／左33%
    - 幅 ≤992px：中央50%／左右25%

---

## 2. キーワードトリガ型チャット応答

### 2.1 トリガキーワード定義

| キーワード | シナリオコード | 応答例 |
| --- | --- | --- |
| 「電気が止まった」／「停電」 | OUTAGE | 「停電とのことですので、再点申込の手順をご案内します。契約番号をお願いします。」 |
| 「請求額」／「支払額」 | BILLING | 「最新の請求額は¥7,980です。支払期限は2025/08/20になります。」 |
| 「プラン変更」 | CHANGE_PLAN | 「プラン変更ですね。現在のプランはナイト・セレクトです。ご希望のプランをお知らせください。」 |
| 「解約」／「廃止」 | TERMINATION | 「ご解約ですね。ご希望の廃止日と理由を教えていただけますか？」 |
| 「パワハラ」／「怒鳴る」 | HARASSMENT | 「お客様の発言にハラスメントの可能性が検知されました。対応方法をご確認ください。」 |

### 2.2 応答ロジック

1. **Transcript 更新時**
    - 新発言に対してキーワードマッチ → トリガ発動
2. **チャットパネルへの自動プロンプト挿入**
    - トリガシナリオに応じた定型質問を先読みして入力欄にセット
3. **AI 応答**
    - シナリオコードを含むコンテキストを `POST /api/chat` に渡し、パーソナライズ回答を取得
4. **履歴記録**
    - 各シナリオ発動回数・タイムスタンプをログに保持

---

## 3. シナリオベースのパーソナライズ

### 3.1 シナリオ定義例

| シナリオコード | 名称 | コンテキストプリプロンプト |
| --- | --- | --- |
| OUTAGE | 停電対応 | 「停電時の再点申込オペレーション手順をガイドしてください。」 |
| BILLING | 請求確認 | 「顧客の最新請求額・支払期限を明確に回答してください。」 |
| CHANGE_PLAN | プラン変更支援 | 「異なる料金プラン間の比較と切替手順を説明してください。」 |
| TERMINATION | 契約廃止手続き | 「契約廃止時の必要情報（理由・日付・返金など）を案内してください。」 |
| HARASSMENT | ハラスメント対応 | 「検知したハラスメント発言に対するエスカレーション手順を提示してください。」 |

### 3.2 ダミーシナリオフロー

```json
[
  {
    "scenario":"OUTAGE",
    "trigger":"電気が止まった",
    "bot_prompt":"停電とのことですので、再点申込の手順をご案内します。契約番号をお願いします。"
  },
  {
    "scenario":"BILLING",
    "trigger":"請求額",
    "bot_prompt":"最新の請求額は¥7,980です。支払期限は2025/08/20です。"
  },
  {
    "scenario":"CHANGE_PLAN",
    "trigger":"プラン変更",
    "bot_prompt":"プラン変更ですね。現在のプランはナイト・セレクトです。ご希望のプランを教えてください。"
  }
]

```

---

## 4. ダミーデータ：動的シナリオ例

```json
[
  { "time":"14:00:01","speaker":"顧客","text":"もしもし、電気が止まったんですが…" },
  { "trigger":"OUTAGE" },
  { "time":"14:00:02","speaker":"bot","text":"停電とのことですので、再点申込の手順をご案内します。契約番号をお願いします。" },
  { "time":"14:00:12","speaker":"顧客","text":"CTR-09-1234-5678です。" },
  { "time":"14:00:13","speaker":"bot","text":"ありがとうございます。未収は¥15,430、最終入金は2025/05/20です。" }
]

```

---

### 5. 今後の実装フロー

1. **キーワードマップ定義ファイル**（`keywords.json`）を作成
2. **Transcript → トリガ検知モジュール**を実装
3. **チャット入力プリフェッチ**：キーワード発動時に自動入力
4. **シナリオごとのAIコンテキスト注入**
5. **UIテスト**：レイアウト調整＋シナリオ応答確認

---

以上の追加要件により、画面内にチャットパネルが常時収まり、通話キーワードに即応するパーソナライズAIチャットボットを実現します。ご確認ください。```